# **ÐÐµÐ´ÐµÐ»Ñ 9-10: ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð¸ ÑÑ‚Ð°Ñ‚ÑƒÑ-ÐºÐ¾Ð´Ñ‹**

## ÐžÐ³Ð»Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ

1. [Ð¢ÐµÐ¾Ñ€ÐµÑ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ñ‡Ð°ÑÑ‚ÑŒ](#Ñ‚ÐµÐ¾Ñ€ÐµÑ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ-Ñ‡Ð°ÑÑ‚ÑŒ)
   - Ð¤Ð¸Ð»Ð¾ÑÐ¾Ñ„Ð¸Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð² Ð²ÐµÐ±-API
   - Ð˜ÐµÑ€Ð°Ñ€Ñ…Ð¸Ñ HTTP ÑÑ‚Ð°Ñ‚ÑƒÑ-ÐºÐ¾Ð´Ð¾Ð²
   - Ð˜ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð² Python Ð¸ FastAPI
2. [ÐŸÑ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ñ‡Ð°ÑÑ‚ÑŒ](#Ð¿Ñ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ-Ñ‡Ð°ÑÑ‚ÑŒ)
   - ÐšÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ
   - Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº
   - Middleware Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð¸ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
   - ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
   - ÐŸÑ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ
   - Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº
3. [ÐŸÑ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ Ð½Ð° Ð½ÐµÐ´ÐµÐ»Ð¸ 9-10](#Ð¿Ñ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ-Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ-Ð½Ð°-Ð½ÐµÐ´ÐµÐ»Ð¸-9-10)

---

## **ðŸ“š Ð¢ÐµÐ¾Ñ€ÐµÑ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ñ‡Ð°ÑÑ‚ÑŒ**

### **1. Ð¤Ð¸Ð»Ð¾ÑÐ¾Ñ„Ð¸Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð² Ð²ÐµÐ±-API**

**ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð²Ð°Ð¶Ð½Ð°:**
- **ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ð¹ Ð¾Ð¿Ñ‹Ñ‚** â€” Ð¿Ð¾Ð½ÑÑ‚Ð½Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ… Ð¿Ð¾Ð¼Ð¾Ð³Ð°ÑŽÑ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÐ¼
- **ÐžÑ‚Ð»Ð°Ð´ÐºÐ°** â€” Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ ÑƒÐ¿Ñ€Ð¾Ñ‰Ð°ÑŽÑ‚ Ð¿Ð¾Ð¸ÑÐº Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼
- **Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ** â€” Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¿Ñ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ÑƒÑ‚ÐµÑ‡ÐºÑƒ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸
- **ÐÐ°Ð´ÐµÐ¶Ð½Ð¾ÑÑ‚ÑŒ** â€” graceful error handling Ð¿Ð¾Ð²Ñ‹ÑˆÐ°ÐµÑ‚ ÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
- **ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³** â€” ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ ÑƒÐ¿Ñ€Ð¾Ñ‰Ð°ÑŽÑ‚ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³

**ÐÐ½Ð°Ð»Ð¾Ð³Ð¸Ñ:** ÐŸÑ€ÐµÐ´ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ Ñ€ÐµÑÑ‚Ð¾Ñ€Ð°Ð½:
- **ÐŸÐ»Ð¾Ñ…Ð°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°:** "Ð§Ñ‚Ð¾-Ñ‚Ð¾ Ð¿Ð¾ÑˆÐ»Ð¾ Ð½Ðµ Ñ‚Ð°Ðº" â€” ÐºÐ»Ð¸ÐµÐ½Ñ‚ Ð½Ðµ Ð·Ð½Ð°ÐµÑ‚, Ñ‡Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ
- **Ð¥Ð¾Ñ€Ð¾ÑˆÐ°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°:** "Ð‘Ð»ÑŽÐ´Ð¾ Ð·Ð°ÐºÐ¾Ð½Ñ‡Ð¸Ð»Ð¾ÑÑŒ, Ð¼Ð¾Ð¶ÐµÐ¼ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶Ð¸Ñ‚ÑŒ Ð°Ð»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ñƒ" â€” Ð¿Ð¾Ð½ÑÑ‚Ð½Ð¾ Ð¸ Ð¿Ð¾Ð»ÐµÐ·Ð½Ð¾

**ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð²Ð°Ð¶Ð½Ð°:**

```python
# ÐŸÐ›ÐžÐ¥Ðž: Ð¡ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸
@app.get("/books/{book_id}")
async def get_book(book_id: int):
    book = await get_book_from_db(book_id)
    return book  # Ð§Ñ‚Ð¾ ÐµÑÐ»Ð¸ book = None?

# ÐŸÐ›ÐžÐ¥Ðž: ÐžÐ±Ñ‰Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸
@app.get("/books/{book_id}")
async def get_book(book_id: int):
    try:
        book = await get_book_from_db(book_id)
        return book
    except Exception as e:
        return {"error": "Ð§Ñ‚Ð¾-Ñ‚Ð¾ Ð¿Ð¾ÑˆÐ»Ð¾ Ð½Ðµ Ñ‚Ð°Ðº"}  # ÐÐµÐ¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ð²Ð½Ð¾!

# Ð¥ÐžÐ ÐžÐ¨Ðž: Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸
@app.get("/books/{book_id}")
async def get_book(book_id: int):
    book = await get_book_from_db(book_id)
    if not book:
        raise HTTPException(
            status_code=404,
            detail="ÐšÐ½Ð¸Ð³Ð° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°",
            headers={"X-Error": "Book not found"}
        )
    return book
```

### **2. Ð˜ÐµÑ€Ð°Ñ€Ñ…Ð¸Ñ HTTP ÑÑ‚Ð°Ñ‚ÑƒÑ-ÐºÐ¾Ð´Ð¾Ð²**

**Ð—Ð°Ñ‡ÐµÐ¼ Ð½ÑƒÐ¶Ð½Ñ‹ ÑÑ‚Ð°Ñ‚ÑƒÑ-ÐºÐ¾Ð´Ñ‹:**
- Ð‘Ñ‹ÑÑ‚Ñ€Ð¾ Ð¿Ð¾Ð½ÑÑ‚ÑŒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°
- ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²
- Ð£Ð»ÑƒÑ‡ÑˆÐ¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ð¹ Ð¾Ð¿Ñ‹Ñ‚
- Ð£Ð¿Ñ€Ð¾ÑÑ‚Ð¸Ñ‚ÑŒ Ð¾Ñ‚Ð»Ð°Ð´ÐºÑƒ

**ÐŸÑ€Ð¸Ð½Ñ†Ð¸Ð¿:** Ð¡Ñ‚Ð°Ñ‚ÑƒÑ-ÐºÐ¾Ð´ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð¾Ñ‚Ñ€Ð°Ð¶Ð°Ñ‚ÑŒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸.

#### **Ð“Ñ€ÑƒÐ¿Ð¿Ñ‹ ÑÑ‚Ð°Ñ‚ÑƒÑ-ÐºÐ¾Ð´Ð¾Ð²:**

```
1xx - Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ (Ñ€ÐµÐ´ÐºÐ¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ÑÑ Ð² API)
     Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ÑÑ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð¼ÐµÐ¶ÑƒÑ‚Ð¾Ñ‡Ð½Ñ‹Ñ… Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²

2xx - Ð£ÑÐ¿ÐµÑˆÐ½Ñ‹Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸
     200 OK - ÑƒÑÐ¿ÐµÑˆÐ½Ñ‹Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ
     201 Created - Ñ€ÐµÑÑƒÑ€Ñ ÑÐ¾Ð·Ð´Ð°Ð½
     204 No Content - ÑƒÑÐ¿ÐµÑˆÐ½Ð¾, Ð½Ð¾ Ð½ÐµÑ‚ Ñ‚ÐµÐ»Ð° Ð¾Ñ‚Ð²ÐµÑ‚Ð°

3xx - ÐŸÐµÑ€ÐµÐ½Ð°Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ
     Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ÑÑ Ð´Ð»Ñ Ñ€ÐµÐ´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ð² (Ñ€ÐµÐ´ÐºÐ¾ Ð² REST API)

4xx - ÐžÑˆÐ¸Ð±ÐºÐ¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° (ÐºÐ»Ð¸ÐµÐ½Ñ‚ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ ÑÐ´ÐµÐ»Ð°Ð» Ð½Ðµ Ñ‚Ð°Ðº)
     ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ñ€Ð¾Ñ
     
5xx - ÐžÑˆÐ¸Ð±ÐºÐ¸ ÑÐµÑ€Ð²ÐµÑ€Ð° (Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ð½Ð° Ð½Ð°ÑˆÐµÐ¹ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ðµ)
     ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ð½Ð° ÑÑ‚Ð¾Ñ€Ð¾Ð½Ðµ ÑÐµÑ€Ð²ÐµÑ€Ð°, ÐºÐ»Ð¸ÐµÐ½Ñ‚ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ
```

**Ð’Ð°Ð¶Ð½Ð¾:** 
- **4xx** â€” Ð²Ð¸Ð½Ð° ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° (Ð½ÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ, Ð½ÐµÑ‚ Ð¿Ñ€Ð°Ð², Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾)
- **5xx** â€” Ð²Ð¸Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ð° (Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð‘Ð”, Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÑÑ Ð¾ÑˆÐ¸Ð±ÐºÐ°, ÑÐµÑ€Ð²Ð¸Ñ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½)

#### **ÐÐ°Ð¸Ð±Ð¾Ð»ÐµÐµ Ð²Ð°Ð¶Ð½Ñ‹Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑ-ÐºÐ¾Ð´Ñ‹ Ð´Ð»Ñ API:**

```python
from fastapi import status

# Ð£ÑÐ¿ÐµÑ… (2xx)
status.HTTP_200_OK = 200  # Ð£ÑÐ¿ÐµÑˆÐ½Ñ‹Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ
status.HTTP_201_CREATED = 201  # Ð ÐµÑÑƒÑ€Ñ ÑÐ¾Ð·Ð´Ð°Ð½
status.HTTP_204_NO_CONTENT = 204  # Ð£ÑÐ¿ÐµÑˆÐ½Ð¾, Ð½Ð¾ Ð½ÐµÑ‚ Ñ‚ÐµÐ»Ð° Ð¾Ñ‚Ð²ÐµÑ‚Ð°

# ÐžÑˆÐ¸Ð±ÐºÐ¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° (4xx)
status.HTTP_400_BAD_REQUEST = 400  # ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ
status.HTTP_401_UNAUTHORIZED = 401  # ÐÐµ Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð¾Ð²Ð°Ð½
status.HTTP_403_FORBIDDEN = 403  # Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ð·Ð°Ð¿Ñ€ÐµÑ‰ÐµÐ½
status.HTTP_404_NOT_FOUND = 404  # Ð ÐµÑÑƒÑ€Ñ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½
status.HTTP_409_CONFLICT = 409  # ÐšÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð´ÑƒÐ±Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ)
status.HTTP_422_UNPROCESSABLE_ENTITY = 422  # ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ (Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ FastAPI)

# ÐžÑˆÐ¸Ð±ÐºÐ¸ ÑÐµÑ€Ð²ÐµÑ€Ð° (5xx)
status.HTTP_500_INTERNAL_SERVER_ERROR = 500  # Ð’Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÑÑ Ð¾ÑˆÐ¸Ð±ÐºÐ° ÑÐµÑ€Ð²ÐµÑ€Ð°
status.HTTP_503_SERVICE_UNAVAILABLE = 503  # Ð¡ÐµÑ€Ð²Ð¸Ñ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½
```

### **3. Ð˜ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð² Python Ð¸ FastAPI**

**Ð˜ÐµÑ€Ð°Ñ€Ñ…Ð¸Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº:**
```
Python Exception â†’ FastAPI HTTPException â†’ Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº â†’ HTTP Response
```

**ÐŸÑ€Ð¸Ð½Ñ†Ð¸Ð¿Ñ‹:**
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð²Ð¼ÐµÑÑ‚Ð¾ Ð¾Ð±Ñ‰Ð¸Ñ…
- Ð›Ð¾Ð³Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ñ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð¾Ð¼
- ÐŸÑ€ÐµÐ¾Ð±Ñ€Ð°Ð·ÑƒÐ¹Ñ‚Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð² Ð¿Ð¾Ð½ÑÑ‚Ð½Ñ‹Ðµ HTTP Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹
- ÐÐµ Ñ€Ð°ÑÐºÑ€Ñ‹Ð²Ð°Ð¹Ñ‚Ðµ Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÑŽÑŽ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð² production

#### **Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Python:**
```python
# Ð’ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ
try:
    # ÐšÐ¾Ð´, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¼Ð¾Ð¶ÐµÑ‚ Ð²Ñ‹Ð·Ð²Ð°Ñ‚ÑŒ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ
    result = 10 / 0
except ZeroDivisionError as e:
    print(f"Ð”ÐµÐ»ÐµÐ½Ð¸Ðµ Ð½Ð° Ð½Ð¾Ð»ÑŒ: {e}")
except ValueError as e:
    print(f"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ: {e}")
except Exception as e:
    print(f"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ°: {e}")
else:
    # Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ, ÐµÑÐ»Ð¸ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹ Ð½Ðµ Ð±Ñ‹Ð»Ð¾
    print("Ð£ÑÐ¿ÐµÑˆÐ½Ð¾!")
finally:
    # Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ Ð²ÑÐµÐ³Ð´Ð°
    print("Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸")
```

#### **Ð˜ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ FastAPI:**
```python
from fastapi import HTTPException

# Ð‘Ð°Ð·Ð¾Ð²Ð¾Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ HTTP
raise HTTPException(
    status_code=404,
    detail="Ð ÐµÑÑƒÑ€Ñ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
)

# Ð¡ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ°Ð¼Ð¸
raise HTTPException(
    status_code=429,
    detail="Ð¡Ð»Ð¸ÑˆÐºÐ¾Ð¼ Ð¼Ð½Ð¾Ð³Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²",
    headers={"Retry-After": "60"}
)

# Ð¡ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ð¼ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸ÐµÐ¼
raise HTTPException(
    status_code=400,
    detail={
        "error": "VALIDATION_ERROR",
        "message": "ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…",
        "field": "email",
        "expected": "valid email address"
    }
)
```

## **ðŸ”§ ÐŸÑ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ñ‡Ð°ÑÑ‚ÑŒ**

### **1. ÐšÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ**

**Ð—Ð°Ñ‡ÐµÐ¼ Ð½ÑƒÐ¶Ð½Ñ‹ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ:**
- Ð•Ð´Ð¸Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð²Ð¾ Ð²ÑÐµÐ¼ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¸
- Ð›ÐµÐ³ÐºÐ¾ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ°Ð¼Ð¸
- Ð”Ð¾Ð±Ð°Ð²Ð»ÑÑ‚ÑŒ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð¸ Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ðµ
- Ð£Ð»ÑƒÑ‡ÑˆÐ°Ñ‚ÑŒ Ñ‡Ð¸Ñ‚Ð°ÐµÐ¼Ð¾ÑÑ‚ÑŒ ÐºÐ¾Ð´Ð°

**ÐŸÑ€Ð¸Ð½Ñ†Ð¸Ð¿Ñ‹:**
- Ð¡Ð¾Ð·Ð´Ð°Ð²Ð°Ð¹Ñ‚Ðµ Ð¸ÐµÑ€Ð°Ñ€Ñ…Ð¸ÑŽ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹ (Ð±Ð°Ð·Ð¾Ð²Ñ‹Ð¹ ÐºÐ»Ð°ÑÑ + ÑÐ¿ÐµÑ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ)
- Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐ¹Ñ‚Ðµ error_code Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð½Ð¾Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸
- Ð’ÐºÐ»ÑŽÑ‡Ð°Ð¹Ñ‚Ðµ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð´Ð»Ñ Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ¸

#### **Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ðµ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ:**
```python
# app/core/exceptions.py
from fastapi import HTTPException, status
from typing import Any, Optional, Dict

class BaseAPIException(HTTPException):
    """Ð‘Ð°Ð·Ð¾Ð²Ð¾Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ API
    
    Ð’ÑÐµ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð½Ð°ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÑŒÑÑ Ð¾Ñ‚ ÑÑ‚Ð¾Ð³Ð¾ ÐºÐ»Ð°ÑÑÐ°.
    Ð­Ñ‚Ð¾ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ Ð¸Ñ… Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ð¼ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¾Ð¼.
    
    ÐÑ‚Ñ€Ð¸Ð±ÑƒÑ‚Ñ‹:
        error_code: ÐšÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð½Ð¾Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸
        context: Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð´Ð»Ñ Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ¸
    """
    
    def __init__(
        self,
        status_code: int,
        detail: Any = None,
        headers: Optional[Dict[str, str]] = None,
        error_code: Optional[str] = None,
        context: Optional[Dict] = None
    ):
        super().__init__(status_code=status_code, detail=detail, headers=headers)
        self.error_code = error_code or f"HTTP_{status_code}"
        self.context = context or {}

class NotFoundException(BaseAPIException):
    """Ð ÐµÑÑƒÑ€Ñ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"""
    
    def __init__(
        self,
        resource_name: str = "Ñ€ÐµÑÑƒÑ€Ñ",
        resource_id: Any = None,
        detail: Optional[str] = None,
        headers: Optional[Dict[str, str]] = None
    ):
        if detail is None:
            if resource_id is not None:
                detail = f"{resource_name.capitalize()} Ñ ID {resource_id} Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
            else:
                detail = f"{resource_name.capitalize()} Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
        
        super().__init__(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=detail,
            headers=headers,
            error_code="NOT_FOUND"
        )

class ValidationException(BaseAPIException):
    """ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…"""
    
    def __init__(
        self,
        detail: str = "ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…",
        errors: Optional[Dict[str, str]] = None,
        headers: Optional[Dict[str, str]] = None
    ):
        error_detail = {
            "message": detail,
            "errors": errors or {}
        }
        
        super().__init__(
            status_code=status.HTTP_422_UNPROCESSABLE_ENTITY,
            detail=error_detail,
            headers=headers,
            error_code="VALIDATION_ERROR"
        )

class UnauthorizedException(BaseAPIException):
    """ÐžÑˆÐ¸Ð±ÐºÐ° Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸"""
    
    def __init__(
        self,
        detail: str = "Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ",
        headers: Optional[Dict[str, str]] = None
    ):
        if headers is None:
            headers = {"WWW-Authenticate": "Bearer"}
        
        super().__init__(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail=detail,
            headers=headers,
            error_code="UNAUTHORIZED"
        )

class ForbiddenException(BaseAPIException):
    """ÐžÑˆÐ¸Ð±ÐºÐ° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸"""
    
    def __init__(
        self,
        detail: str = "ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð¿Ñ€Ð°Ð²",
        required_roles: Optional[list] = None,
        headers: Optional[Dict[str, str]] = None
    ):
        detail_dict = {"message": detail}
        if required_roles:
            detail_dict["required_roles"] = required_roles
        
        super().__init__(
            status_code=status.HTTP_403_FORBIDDEN,
            detail=detail_dict,
            headers=headers,
            error_code="FORBIDDEN"
        )

class ConflictException(BaseAPIException):
    """ÐšÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…"""
    
    def __init__(
        self,
        detail: str = "ÐšÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…",
        resource: Optional[str] = None,
        conflicting_field: Optional[str] = None,
        conflicting_value: Optional[Any] = None,
        headers: Optional[Dict[str, str]] = None
    ):
        detail_dict = {"message": detail}
        if resource and conflicting_field and conflicting_value:
            detail_dict.update({
                "resource": resource,
                "conflicting_field": conflicting_field,
                "conflicting_value": conflicting_value
            })
        
        super().__init__(
            status_code=status.HTTP_409_CONFLICT,
            detail=detail_dict,
            headers=headers,
            error_code="CONFLICT"
        )

class RateLimitException(BaseAPIException):
    """ÐŸÑ€ÐµÐ²Ñ‹ÑˆÐµÐ½ Ð»Ð¸Ð¼Ð¸Ñ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²"""
    
    def __init__(
        self,
        detail: str = "ÐŸÑ€ÐµÐ²Ñ‹ÑˆÐµÐ½ Ð»Ð¸Ð¼Ð¸Ñ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²",
        retry_after: int = 60,
        limit: Optional[int] = None,
        remaining: Optional[int] = None,
        reset_time: Optional[int] = None,
        headers: Optional[Dict[str, str]] = None
    ):
        if headers is None:
            headers = {"Retry-After": str(retry_after)}
        
        detail_dict = {"message": detail}
        if limit is not None:
            detail_dict["limit"] = limit
        if remaining is not None:
            detail_dict["remaining"] = remaining
        if reset_time is not None:
            detail_dict["reset_time"] = reset_time
        
        super().__init__(
            status_code=status.HTTP_429_TOO_MANY_REQUESTS,
            detail=detail_dict,
            headers=headers,
            error_code="RATE_LIMIT_EXCEEDED"
        )

class ServiceUnavailableException(BaseAPIException):
    """Ð¡ÐµÑ€Ð²Ð¸Ñ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½"""
    
    def __init__(
        self,
        detail: str = "Ð¡ÐµÑ€Ð²Ð¸Ñ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½",
        retry_after: int = 30,
        service: Optional[str] = None,
        estimated_recovery_time: Optional[str] = None,
        headers: Optional[Dict[str, str]] = None
    ):
        if headers is None:
            headers = {"Retry-After": str(retry_after)}
        
        detail_dict = {"message": detail}
        if service:
            detail_dict["service"] = service
        if estimated_recovery_time:
            detail_dict["estimated_recovery_time"] = estimated_recovery_time
        
        super().__init__(
            status_code=status.HTTP_503_SERVICE_UNAVAILABLE,
            detail=detail_dict,
            headers=headers,
            error_code="SERVICE_UNAVAILABLE"
        )
```

#### **Ð‘Ð¸Ð·Ð½ÐµÑ-Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð´Ð»Ñ Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ¸:**

**Ð—Ð°Ñ‡ÐµÐ¼ Ð½ÑƒÐ¶Ð½Ñ‹ Ð±Ð¸Ð·Ð½ÐµÑ-Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ:**
- Ð¡Ð¿ÐµÑ†Ð¸Ñ„Ð¸Ñ‡Ð½Ñ‹Ðµ Ð´Ð»Ñ Ð´Ð¾Ð¼ÐµÐ½Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ¸
- ÐŸÐ¾Ð½ÑÑ‚Ð½Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
- ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð½Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ¸
- Ð•Ð´Ð¸Ð½Ð¾Ð¾Ð±Ñ€Ð°Ð·Ð½Ð°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð±Ð¸Ð·Ð½ÐµÑ-Ð¾ÑˆÐ¸Ð±Ð¾Ðº

```python
# app/core/library_exceptions.py
from app.core.exceptions import (
    BaseAPIException, NotFoundException, 
    ConflictException, ValidationException
)
from fastapi import status

class BookNotFoundException(NotFoundException):
    """ÐšÐ½Ð¸Ð³Ð° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°"""
    
    def __init__(self, book_id: Any = None):
        super().__init__(
            resource_name="ÐºÐ½Ð¸Ð³Ð°",
            resource_id=book_id,
            detail=f"ÐšÐ½Ð¸Ð³Ð° Ñ ID {book_id} Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°" if book_id else "ÐšÐ½Ð¸Ð³Ð° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°"
        )

class BookNotAvailableException(BaseAPIException):
    """ÐšÐ½Ð¸Ð³Ð° Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð° Ð´Ð»Ñ Ð°Ñ€ÐµÐ½Ð´Ñ‹"""
    
    def __init__(self, book_id: int, available_copies: int = 0):
        detail = {
            "message": f"ÐšÐ½Ð¸Ð³Ð° Ñ ID {book_id} Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð° Ð´Ð»Ñ Ð°Ñ€ÐµÐ½Ð´Ñ‹",
            "book_id": book_id,
            "available_copies": available_copies,
            "reason": "NO_COPIES_AVAILABLE" if available_copies == 0 else "BOOK_BORROWED"
        }
        
        super().__init__(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail=detail,
            error_code="BOOK_NOT_AVAILABLE"
        )

class UserAlreadyHasBookException(ConflictException):
    """ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ ÑƒÐ¶Ðµ Ð¸Ð¼ÐµÐµÑ‚ ÑÑ‚Ñƒ ÐºÐ½Ð¸Ð³Ñƒ"""
    
    def __init__(self, user_id: int, book_id: int):
        detail = {
            "message": f"ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ {user_id} ÑƒÐ¶Ðµ Ð°Ñ€ÐµÐ½Ð´Ð¾Ð²Ð°Ð» ÐºÐ½Ð¸Ð³Ñƒ {book_id}",
            "user_id": user_id,
            "book_id": book_id,
            "suggestion": "Ð’ÐµÑ€Ð½Ð¸Ñ‚Ðµ ÐºÐ½Ð¸Ð³Ñƒ Ð¿Ñ€ÐµÐ¶Ð´Ðµ Ñ‡ÐµÐ¼ Ð±Ñ€Ð°Ñ‚ÑŒ Ð½Ð¾Ð²ÑƒÑŽ"
        }
        
        super().__init__(
            detail=detail,
            resource="booking",
            conflicting_field="user_id_book_id",
            conflicting_value=f"{user_id}_{book_id}"
        )

class BookingOverdueException(BaseAPIException):
    """Ð‘Ñ€Ð¾Ð½ÑŒ Ð¿Ñ€Ð¾ÑÑ€Ð¾Ñ‡ÐµÐ½Ð°"""
    
    def __init__(self, booking_id: int, overdue_days: int, penalty: float):
        detail = {
            "message": f"Ð‘Ñ€Ð¾Ð½ÑŒ {booking_id} Ð¿Ñ€Ð¾ÑÑ€Ð¾Ñ‡ÐµÐ½Ð° Ð½Ð° {overdue_days} Ð´Ð½ÐµÐ¹",
            "booking_id": booking_id,
            "overdue_days": overdue_days,
            "penalty": penalty,
            "action_required": "Ð’ÐµÑ€Ð½Ð¸Ñ‚Ðµ ÐºÐ½Ð¸Ð³Ñƒ Ð¸ Ð¾Ð¿Ð»Ð°Ñ‚Ð¸Ñ‚Ðµ ÑˆÑ‚Ñ€Ð°Ñ„"
        }
        
        super().__init__(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail=detail,
            error_code="BOOKING_OVERDUE"
        )

class InsufficientFundsException(BaseAPIException):
    """ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑÑ€ÐµÐ´ÑÑ‚Ð²"""
    
    def __init__(self, user_id: int, required: float, available: float):
        detail = {
            "message": "ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑÑ€ÐµÐ´ÑÑ‚Ð² Ð´Ð»Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸",
            "user_id": user_id,
            "required_amount": required,
            "available_amount": available,
            "deficit": required - available
        }
        
        super().__init__(
            status_code=status.HTTP_402_PAYMENT_REQUIRED,
            detail=detail,
            error_code="INSUFFICIENT_FUNDS"
        )

class DatabaseConnectionException(BaseAPIException):
    """ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº Ð‘Ð”"""
    
    def __init__(self, service: str = "database"):
        detail = {
            "message": f"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº {service}",
            "service": service,
            "suggestion": "ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ Ð¸Ð»Ð¸ Ð¾Ð±Ñ€Ð°Ñ‚Ð¸Ñ‚ÐµÑÑŒ Ð² Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÑƒ"
        }
        
        super().__init__(
            status_code=status.HTTP_503_SERVICE_UNAVAILABLE,
            detail=detail,
            error_code="DATABASE_CONNECTION_ERROR"
        )
```

### **2. Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº**

#### **Ð“Ð»Ð°Ð²Ð½Ñ‹Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹:**
```python
# app/core/exception_handlers.py
import logging
import traceback
from datetime import datetime, timezone
from typing import Any, Dict, Optional, Union
from fastapi import FastAPI, Request, status
from fastapi.responses import JSONResponse
from fastapi.exceptions import RequestValidationError
from pydantic import ValidationError
from sqlalchemy.exc import SQLAlchemyError, IntegrityError

from app.core.exceptions import BaseAPIException
from app.core.config import settings

logger = logging.getLogger(__name__)

def setup_exception_handlers(app: FastAPI):
    """ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¾Ð² Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹"""
    
    @app.exception_handler(BaseAPIException)
    async def api_exception_handler(request: Request, exc: BaseAPIException):
        """ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ñ… Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹ API
        
        ÐžÐ±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ Ð²ÑÐµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ, Ð½Ð°ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸ÐµÑÑ Ð¾Ñ‚ BaseAPIException.
        Ð­Ñ‚Ð¾ Ð²ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ NotFoundException, ValidationException, Ð¸ Ð´Ñ€ÑƒÐ³Ð¸Ðµ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ.
        
        Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð°:
        {
            "error": {
                "code": "ERROR_CODE",
                "message": "ÐŸÐ¾Ð½ÑÑ‚Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ",
                "details": {...},
                "path": "/api/v1/books/123",
                "timestamp": "2024-01-01T10:00:00Z"
            }
        }
        """
        # Ð›Ð¾Ð³Ð¸Ñ€ÑƒÐµÐ¼ Ñ ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¼ WARNING, Ñ‚Ð°Ðº ÐºÐ°Ðº ÑÑ‚Ð¾ Ð¾Ð¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ðµ Ð±Ð¸Ð·Ð½ÐµÑ-Ð¾ÑˆÐ¸Ð±ÐºÐ¸
        # (Ð½Ðµ Ñ‚ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ ÑÐ±Ð¾Ð¸)
        logger.warning(
            f"API Exception: {exc.error_code} - {exc.detail}",
            extra={
                "path": request.url.path,
                "method": request.method,
                "error_code": exc.error_code,
                "status_code": exc.status_code,
                "context": exc.context,
                "request_id": getattr(request.state, "request_id", None)
            }
        )
        
        # Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ
        # Ð˜Ð·Ð²Ð»ÐµÐºÐ°ÐµÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¸Ð· detail (Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ dict Ð¸Ð»Ð¸ str)
        if isinstance(exc.detail, dict):
            message = exc.detail.get("message", str(exc.detail))
            details = exc.detail
        else:
            message = str(exc.detail)
            details = None
        
        response_data = {
            "error": {
                "code": exc.error_code,
                "message": message,
                "details": details,
                "path": request.url.path,
                "timestamp": datetime.now(timezone.utc).isoformat() + "Z"
            }
        }
        
        # Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð´Ð»Ñ Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ¸ Ð² Ñ€ÐµÐ¶Ð¸Ð¼Ðµ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸
        # Ð’ production ÑÑ‚Ð¾ Ð½Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ñ€Ð°ÑÐºÑ€Ñ‹Ð²Ð°Ñ‚ÑŒÑÑ
        if settings.DEBUG and exc.context:
            response_data["error"]["context"] = exc.context
        
        return JSONResponse(
            status_code=exc.status_code,
            content=response_data,
            headers=exc.headers
        )
    
    @app.exception_handler(RequestValidationError)
    async def validation_exception_handler(request: Request, exc: RequestValidationError):
        """ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ FastAPI"""
        errors = []
        
        for error in exc.errors():
            error_detail = {
                "field": " -> ".join(str(loc) for loc in error["loc"]),
                "message": error["msg"],
                "type": error["type"]
            }
            
            # Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð´ÐµÑ‚Ð°Ð»Ð¸ Ð´Ð»Ñ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð½Ñ‹Ñ… Ñ‚Ð¸Ð¿Ð¾Ð² Ð¾ÑˆÐ¸Ð±Ð¾Ðº
            if "ctx" in error:
                error_detail["context"] = error["ctx"]
            
            errors.append(error_detail)
        
        logger.warning(
            f"Validation error: {errors}",
            extra={
                "path": request.url.path,
                "method": request.method,
                "errors": errors,
                "body": str(exc.body) if hasattr(exc, 'body') else None
            }
        )
        
        response_data = {
            "error": {
                "code": "VALIDATION_ERROR",
                "message": "ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…",
                "errors": errors,
                "path": request.url.path
            }
        }
        
        return JSONResponse(
            status_code=status.HTTP_422_UNPROCESSABLE_ENTITY,
            content=response_data
        )
    
    @app.exception_handler(ValidationError)
    async def pydantic_validation_exception_handler(request: Request, exc: ValidationError):
        """ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ Pydantic
        
        ÐžÐ±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ Pydantic Ð¼Ð¾Ð´ÐµÐ»ÐµÐ¹.
        ÐžÐ±Ñ‹Ñ‡Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð´Ð»Ñ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ,
        Ð° Ð½Ðµ Ð½Ð° ÑƒÑ€Ð¾Ð²Ð½Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° (Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ RequestValidationError).
        
        ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ: Ð’ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ð½ÑÑ‚Ð²Ðµ ÑÐ»ÑƒÑ‡Ð°ÐµÐ² FastAPI Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ RequestValidationError,
        Ð½Ð¾ ÑÑ‚Ð¾Ñ‚ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð¿Ð¾Ð»ÐµÐ·ÐµÐ½ Ð´Ð»Ñ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ Ð² ÑÐµÑ€Ð²Ð¸ÑÐ°Ñ….
        """
        errors = []
        
        for error in exc.errors():
            # Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ Ð¿ÑƒÑ‚ÑŒ Ðº Ð¿Ð¾Ð»ÑŽ
            field_path = " -> ".join(str(loc) for loc in error["loc"])
            
            error_detail = {
                "field": field_path,
                "message": error["msg"],
                "type": error["type"]
            }
            
            # Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ
            if "ctx" in error:
                error_detail["context"] = error["ctx"]
            
            errors.append(error_detail)
        
        response_data = {
            "error": {
                "code": "SCHEMA_VALIDATION_ERROR",
                "message": "ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ ÑÑ…ÐµÐ¼Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…",
                "errors": errors
            }
        }
        
        return JSONResponse(
            status_code=status.HTTP_422_UNPROCESSABLE_ENTITY,
            content=response_data
        )
    
    @app.exception_handler(IntegrityError)
    async def integrity_error_handler(request: Request, exc: IntegrityError):
        """ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ñ†ÐµÐ»Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚Ð¸ Ð‘Ð”
        
        ÐžÐ±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÐ¸, ÑÐ²ÑÐ·Ð°Ð½Ð½Ñ‹Ðµ Ñ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸ÑÐ¼Ð¸ Ð‘Ð”:
        - ÐÐ°Ñ€ÑƒÑˆÐµÐ½Ð¸Ðµ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ (UNIQUE constraint)
        - ÐÐ°Ñ€ÑƒÑˆÐµÐ½Ð¸Ðµ Ð²Ð½ÐµÑˆÐ½Ð¸Ñ… ÐºÐ»ÑŽÑ‡ÐµÐ¹ (FOREIGN KEY constraint)
        - Ð”Ñ€ÑƒÐ³Ð¸Ðµ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ Ñ†ÐµÐ»Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚Ð¸
        
        ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ: ÐÐ½Ð°Ð»Ð¸Ð· Ñ‚ÐµÐºÑÑ‚Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð¼Ð¾Ð¶ÐµÑ‚ Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð°Ñ‚ÑŒÑÑ Ð´Ð»Ñ Ñ€Ð°Ð·Ð½Ñ‹Ñ… Ð¡Ð£Ð‘Ð”.
        """
        error_message = str(exc.orig)
        
        # ÐÐ½Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐµÐ¼ Ñ‚Ð¸Ð¿ Ð¾ÑˆÐ¸Ð±ÐºÐ¸
        # ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ: Ð¢ÐµÐºÑÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ Ð¡Ð£Ð‘Ð” (PostgreSQL, MySQL, SQLite)
        if "unique constraint" in error_message.lower() or "duplicate key" in error_message.lower():
            error_code = "UNIQUE_CONSTRAINT_VIOLATION"
            message = "ÐÐ°Ñ€ÑƒÑˆÐµÐ½Ð¸Ðµ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…"
            
            # ÐŸÑ‹Ñ‚Ð°ÐµÐ¼ÑÑ Ð¸Ð·Ð²Ð»ÐµÑ‡ÑŒ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð»Ñ Ð¸Ð· Ð¾ÑˆÐ¸Ð±ÐºÐ¸
            # Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ Ð¼Ð¾Ð¶ÐµÑ‚ Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð°Ñ‚ÑŒÑÑ: PostgreSQL, MySQL, SQLite
            import re
            match = re.search(r'\((.*?)\)|key\s+["\']?(\w+)["\']?', error_message, re.IGNORECASE)
            field = match.group(1) or match.group(2) if match else "unknown"
            
            detail = {
                "message": message,
                "field": field,
                "suggestion": "Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»Ñ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¼"
            }
        elif "foreign key constraint" in error_message.lower() or "foreign key" in error_message.lower():
            error_code = "FOREIGN_KEY_VIOLATION"
            message = "ÐÐ°Ñ€ÑƒÑˆÐµÐ½Ð¸Ðµ ÑÑÑ‹Ð»Ð¾Ñ‡Ð½Ð¾Ð¹ Ñ†ÐµÐ»Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚Ð¸"
            detail = {
                "message": message,
                "suggestion": "ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÐ²ÑÐ·Ð°Ð½Ð½Ñ‹Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸. Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾, ÑÐ²ÑÐ·Ð°Ð½Ð½Ñ‹Ð¹ Ð¾Ð±ÑŠÐµÐºÑ‚ Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚."
            }
        else:
            error_code = "INTEGRITY_ERROR"
            detail = {"message": "ÐžÑˆÐ¸Ð±ÐºÐ° Ñ†ÐµÐ»Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…"}
        
        logger.error(
            f"Database integrity error: {error_message}",
            extra={
                "path": request.url.path,
                "method": request.method,
                "error_code": error_code,
                "sql_error": error_message
            }
        )
        
        response_data = {
            "error": {
                "code": error_code,
                "message": "ÐžÑˆÐ¸Ð±ÐºÐ° Ñ†ÐµÐ»Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…",
                "details": detail
            }
        }
        
        return JSONResponse(
            status_code=status.HTTP_409_CONFLICT,
            content=response_data
        )
    
    @app.exception_handler(SQLAlchemyError)
    async def sqlalchemy_exception_handler(request: Request, exc: SQLAlchemyError):
        """ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð¾Ð±Ñ‰Ð¸Ñ… Ð¾ÑˆÐ¸Ð±Ð¾Ðº SQLAlchemy"""
        error_message = str(exc)
        
        logger.error(
            f"Database error: {error_message}",
            extra={
                "path": request.url.path,
                "method": request.method,
                "error_type": exc.__class__.__name__,
                "sql_error": error_message,
                "traceback": traceback.format_exc()
            },
            exc_info=True
        )
        
        response_data = {
            "error": {
                "code": "DATABASE_ERROR",
                "message": "ÐžÑˆÐ¸Ð±ÐºÐ° Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…",
                "details": {
                    "message": "Ð’Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÑÑ Ð¾ÑˆÐ¸Ð±ÐºÐ° ÑÐµÑ€Ð²ÐµÑ€Ð° Ð¿Ñ€Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ Ñ Ð±Ð°Ð·Ð¾Ð¹ Ð´Ð°Ð½Ð½Ñ‹Ñ…",
                    "suggestion": "ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ Ð¸Ð»Ð¸ Ð¾Ð±Ñ€Ð°Ñ‚Ð¸Ñ‚ÐµÑÑŒ Ð² Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÑƒ"
                }
            }
        }
        
        # Ð’ Ñ€ÐµÐ¶Ð¸Ð¼Ðµ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ð±Ð¾Ð»ÑŒÑˆÐµ Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹
        if settings.DEBUG:
            response_data["error"]["debug"] = {
                "type": exc.__class__.__name__,
                "message": error_message
            }
        
        return JSONResponse(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            content=response_data
        )
    
    @app.exception_handler(Exception)
    async def general_exception_handler(request: Request, exc: Exception):
        """Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð²ÑÐµÑ… Ð½ÐµÐ¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ð½Ñ‹Ñ… Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹"""
        error_type = exc.__class__.__name__
        error_message = str(exc)
        
        logger.critical(
            f"Unhandled exception: {error_type} - {error_message}",
            extra={
                "path": request.url.path,
                "method": request.method,
                "error_type": error_type,
                "error_message": error_message,
                "traceback": traceback.format_exc(),
                "client_ip": request.client.host if request.client else None,
                "user_agent": request.headers.get("user-agent"),
                "request_id": getattr(request.state, "request_id", None)
            },
            exc_info=True
        )
        
        response_data = {
            "error": {
                "code": "INTERNAL_SERVER_ERROR",
                "message": "Ð’Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÑÑ Ð¾ÑˆÐ¸Ð±ÐºÐ° ÑÐµÑ€Ð²ÐµÑ€Ð°",
                "details": {
                    "message": "ÐŸÑ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð° Ð½ÐµÐ¿Ñ€ÐµÐ´Ð²Ð¸Ð´ÐµÐ½Ð½Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ°",
                    "suggestion": "ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ Ð¸Ð»Ð¸ Ð¾Ð±Ñ€Ð°Ñ‚Ð¸Ñ‚ÐµÑÑŒ Ð² Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÑƒ"
                }
            }
        }
        
        # Ð’ Ñ€ÐµÐ¶Ð¸Ð¼Ðµ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ traceback
        if settings.DEBUG:
            response_data["error"]["debug"] = {
                "type": error_type,
                "message": error_message,
                "traceback": traceback.format_exc().split("\n")
            }
        
        return JSONResponse(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            content=response_data
        )
    
    @app.exception_handler(404)
    async def not_found_exception_handler(request: Request, exc: Exception):
        """ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº 404 Ð¾ÑˆÐ¸Ð±Ð¾Ðº"""
        response_data = {
            "error": {
                "code": "ENDPOINT_NOT_FOUND",
                "message": "Ð­Ð½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½",
                "details": {
                    "path": request.url.path,
                    "method": request.method,
                    "suggestion": "ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ URL Ð¸Ð»Ð¸ Ð¾Ð±Ñ€Ð°Ñ‚Ð¸Ñ‚ÐµÑÑŒ Ðº Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸ API"
                }
            }
        }
        
        return JSONResponse(
            status_code=status.HTTP_404_NOT_FOUND,
            content=response_data
        )
```

### **3. Middleware Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð¸ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ**

**Ð§Ñ‚Ð¾ Ñ‚Ð°ÐºÐ¾Ðµ Middleware:**
- ÐŸÑ€Ð¾Ð¼ÐµÐ¶ÑƒÑ‚Ð¾Ñ‡Ð½Ð¾Ðµ ÐŸÐž, ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹
- Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ Ð´Ð¾ Ð¸ Ð¿Ð¾ÑÐ»Ðµ endpoint'Ð¾Ð²
- ÐŸÐ¾Ð»ÐµÐ·Ð½Ð¾ Ð´Ð»Ñ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ, Ð¸Ð·Ð¼ÐµÑ€ÐµÐ½Ð¸Ñ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸, Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¾Ð²

**ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ:**
```
Request â†’ Middleware 1 â†’ Middleware 2 â†’ ... â†’ Endpoint â†’ Middleware 2 â†’ Middleware 1 â†’ Response
```

**ÐŸÑ€Ð¸Ð½Ñ†Ð¸Ð¿Ñ‹:**
- Middleware Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑŽÑ‚ÑÑ Ð² Ð¿Ð¾Ñ€ÑÐ´ÐºÐµ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸
- ÐžÐ±Ñ€Ð°Ñ‚Ð½Ñ‹Ð¹ Ð¿Ð¾Ñ€ÑÐ´Ð¾Ðº Ð¿Ñ€Ð¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ðµ Ð¾Ñ‚Ð²ÐµÑ‚Ð°
- ÐœÐ¾Ð³ÑƒÑ‚ Ð¼Ð¾Ð´Ð¸Ñ„Ð¸Ñ†Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ request Ð¸ response

```python
# app/core/middleware.py
import time
import uuid
import logging
from typing import Callable
from fastapi import Request, Response
from starlette.middleware.base import BaseHTTPMiddleware
from starlette.types import ASGIApp

logger = logging.getLogger(__name__)

class RequestIDMiddleware(BaseHTTPMiddleware):
    """Middleware Ð´Ð»Ñ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ ID Ðº ÐºÐ°Ð¶Ð´Ð¾Ð¼Ñƒ Ð·Ð°Ð¿Ñ€Ð¾ÑÑƒ"""
    
    async def dispatch(self, request: Request, call_next: Callable) -> Response:
        request_id = str(uuid.uuid4())
        request.state.request_id = request_id
        
        # Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ request_id Ð² Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¸ Ð¾Ñ‚Ð²ÐµÑ‚Ð°
        response = await call_next(request)
        response.headers["X-Request-ID"] = request_id
        
        return response

class TimingMiddleware(BaseHTTPMiddleware):
    """Middleware Ð´Ð»Ñ Ð¸Ð·Ð¼ÐµÑ€ÐµÐ½Ð¸Ñ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°
    
    Ð˜Ð·Ð¼ÐµÑ€ÑÐµÑ‚ Ð²Ñ€ÐµÐ¼Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ð¸:
    - Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÑ‚ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº X-Process-Time Ð² Ð¾Ñ‚Ð²ÐµÑ‚
    - Ð›Ð¾Ð³Ð¸Ñ€ÑƒÐµÑ‚ Ð¼ÐµÐ´Ð»ÐµÐ½Ð½Ñ‹Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð´Ð»Ñ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°
    - ÐŸÐ¾Ð¼Ð¾Ð³Ð°ÐµÑ‚ Ð²Ñ‹ÑÐ²Ð»ÑÑ‚ÑŒ ÑƒÐ·ÐºÐ¸Ðµ Ð¼ÐµÑÑ‚Ð° Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸
    
    Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ:
        app.add_middleware(TimingMiddleware)
    """
    
    async def dispatch(self, request: Request, call_next: Callable) -> Response:
        start_time = time.time()
        request.state.timestamp = start_time
        
        response = await call_next(request)
        
        process_time = time.time() - start_time
        # Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð²Ñ€ÐµÐ¼Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð² Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¸ Ð´Ð»Ñ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°
        response.headers["X-Process-Time"] = f"{process_time:.4f}"
        
        # Ð›Ð¾Ð³Ð¸Ñ€ÑƒÐµÐ¼ Ð¼ÐµÐ´Ð»ÐµÐ½Ð½Ñ‹Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð´Ð»Ñ Ð²Ñ‹ÑÐ²Ð»ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸
        # ÐŸÐ¾Ñ€Ð¾Ð³ Ð¼Ð¾Ð¶Ð½Ð¾ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ Ð² Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ‚ Ñ‚Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ð¹
        if process_time > 1.0:  # Ð‘Ð¾Ð»ÐµÐµ 1 ÑÐµÐºÑƒÐ½Ð´Ñ‹
            logger.warning(
                f"Slow request: {request.method} {request.url.path} - {process_time:.2f}s",
                extra={
                    "path": request.url.path,
                    "method": request.method,
                    "process_time": process_time,
                    "client_ip": request.client.host if request.client else None,
                    "request_id": getattr(request.state, "request_id", None)
                }
            )
        
        return response

class LoggingMiddleware(BaseHTTPMiddleware):
    """Middleware Ð´Ð»Ñ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð²ÑÐµÑ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²
    
    Ð›Ð¾Ð³Ð¸Ñ€ÑƒÐµÑ‚:
    - Ð’Ñ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ (Ð¼ÐµÑ‚Ð¾Ð´, Ð¿ÑƒÑ‚ÑŒ, Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¸)
    - Ð˜ÑÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹ (ÑÑ‚Ð°Ñ‚ÑƒÑ-ÐºÐ¾Ð´, Ñ€Ð°Ð·Ð¼ÐµÑ€, Ð²Ñ€ÐµÐ¼Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸)
    - ÐžÑˆÐ¸Ð±ÐºÐ¸ Ð² middleware
    
    ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ: Ð’ production Ð¼Ð¾Ð¶ÐµÑ‚ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ð¼Ð½Ð¾Ð³Ð¾ Ð»Ð¾Ð³Ð¾Ð².
    Ð Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ñ‚Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ Ð¸Ð»Ð¸ sampling.
    """
    
    async def dispatch(self, request: Request, call_next: Callable) -> Response:
        # Ð›Ð¾Ð³Ð¸Ñ€ÑƒÐµÐ¼ Ð²Ñ…Ð¾Ð´ÑÑ‰Ð¸Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ
        logger.info(
            f"Incoming request: {request.method} {request.url.path}",
            extra={
                "path": request.url.path,
                "method": request.method,
                "client_ip": request.client.host if request.client else None,
                "user_agent": request.headers.get("user-agent"),
                "content_type": request.headers.get("content-type"),
                "request_id": getattr(request.state, "request_id", None)
            }
        )
        
        try:
            response = await call_next(request)
            
            # Ð›Ð¾Ð³Ð¸Ñ€ÑƒÐµÐ¼ Ð¾Ñ‚Ð²ÐµÑ‚
            # ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ: response.body Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð´Ð»Ñ streaming Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²
            response_size = 0
            if hasattr(response, 'body'):
                try:
                    response_size = len(response.body)
                except (TypeError, AttributeError):
                    pass
            
            logger.info(
                f"Response: {request.method} {request.url.path} - {response.status_code}",
                extra={
                    "path": request.url.path,
                    "method": request.method,
                    "status_code": response.status_code,
                    "response_size": response_size,
                    "process_time": float(response.headers.get("X-Process-Time", 0)),
                    "request_id": getattr(request.state, "request_id", None)
                }
            )
            
            return response
            
        except Exception as e:
            # Ð›Ð¾Ð³Ð¸Ñ€ÑƒÐµÐ¼ Ð½ÐµÐ¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ð½Ñ‹Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð² middleware
            # Ð­Ñ‚Ð¾ Ð½Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚ÑŒ, Ñ‚Ð°Ðº ÐºÐ°Ðº Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒÑÑ
            # Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ°Ð¼Ð¸, Ð½Ð¾ Ð½Ð° Ð²ÑÑÐºÐ¸Ð¹ ÑÐ»ÑƒÑ‡Ð°Ð¹ Ð»Ð¾Ð³Ð¸Ñ€ÑƒÐµÐ¼
            logger.error(
                f"Unhandled exception in middleware: {type(e).__name__} - {str(e)}",
                extra={
                    "path": request.url.path,
                    "method": request.method,
                    "error_type": type(e).__name__,
                    "error_message": str(e),
                    "request_id": getattr(request.state, "request_id", None)
                },
                exc_info=True
            )
            raise

class ErrorHandlingMiddleware(BaseHTTPMiddleware):
    """Middleware Ð´Ð»Ñ Ñ†ÐµÐ½Ñ‚Ñ€Ð°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ð¾Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº
    
    ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ: Ð’ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ð½ÑÑ‚Ð²Ðµ ÑÐ»ÑƒÑ‡Ð°ÐµÐ² ÑÑ‚Ð¾Ñ‚ middleware Ð½Ðµ Ð½ÑƒÐ¶ÐµÐ½,
    Ñ‚Ð°Ðº ÐºÐ°Ðº FastAPI Ð¸Ð¼ÐµÐµÑ‚ Ð²ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹.
    Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÐµÐ³Ð¾ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð° Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð»Ð¾Ð³Ð¸ÐºÐ° Ð¿ÐµÑ€ÐµÐ´ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¾Ð¹.
    
    ÐÐ»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð°: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ Ñ‡ÐµÑ€ÐµÐ· @app.exception_handler
    """
    
    async def dispatch(self, request: Request, call_next: Callable) -> Response:
        try:
            return await call_next(request)
            
        except Exception as e:
            # Ð›Ð¾Ð³Ð¸Ñ€ÑƒÐµÐ¼ Ð¾ÑˆÐ¸Ð±ÐºÑƒ Ñ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð¾Ð¼
            # ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ: Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ Ñ‚Ð°ÐºÐ¶Ðµ Ð»Ð¾Ð³Ð¸Ñ€ÑƒÑŽÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÐ¸,
            # Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ Ð·Ð´ÐµÑÑŒ Ð¼Ð¾Ð¶Ð½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½ÑƒÑŽ Ð»Ð¾Ð³Ð¸ÐºÑƒ
            logger.error(
                f"Error in request processing: {type(e).__name__}",
                extra={
                    "path": request.url.path,
                    "method": request.method,
                    "error_type": type(e).__name__,
                    "error_message": str(e),
                    "request_id": getattr(request.state, "request_id", None),
                    "client_ip": request.client.host if request.client else None
                },
                exc_info=True
            )
            
            # ÐŸÑ€Ð¾Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð´Ð°Ð»ÑŒÑˆÐµ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ°Ð¼Ð¸
            # Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·ÑƒÑŽÑ‚ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð² HTTP Ð¾Ñ‚Ð²ÐµÑ‚
            raise
```

### **4. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ**

**Ð—Ð°Ñ‡ÐµÐ¼ Ð½ÑƒÐ¶Ð½Ð¾ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ðµ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ:**
- Ð›ÐµÐ³ÐºÐ¾ Ð¿Ð°Ñ€ÑÐ¸Ñ‚ÑŒ Ð¸ Ð°Ð½Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð»Ð¾Ð³Ð¸
- Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°Ð¼Ð¸ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° (ELK, Loki, Splunk)
- ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¼ Ð¿Ð¾Ð»ÑÐ¼
- ÐÐ³Ñ€ÐµÐ³Ð°Ñ†Ð¸Ñ Ð¸ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°

**ÐŸÑ€Ð¸Ð½Ñ†Ð¸Ð¿Ñ‹ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐ³Ð¾ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ:**
- **Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾ÑÑ‚ÑŒ** â€” JSON Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð´Ð»Ñ Ð¼Ð°ÑˆÐ¸Ð½Ð½Ð¾Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸
- **ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚** â€” Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐ¹Ñ‚Ðµ request_id, user_id, Ð¸ Ñ‚.Ð´.
- **Ð£Ñ€Ð¾Ð²Ð½Ð¸** â€” Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ðµ ÑƒÑ€Ð¾Ð²Ð½Ð¸ (DEBUG, INFO, WARNING, ERROR, CRITICAL)
- **Ð Ð¾Ñ‚Ð°Ñ†Ð¸Ñ** â€” Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡Ð¸Ð²Ð°Ð¹Ñ‚Ðµ Ñ€Ð°Ð·Ð¼ÐµÑ€ Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð»Ð¾Ð³Ð¾Ð²

```python
# app/core/logging_config.py
import logging
import logging.config
import json
from datetime import datetime, timezone
from typing import Dict, Any
import sys

class JSONFormatter(logging.Formatter):
    """Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚Ñ‚ÐµÑ€ Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð° Ð»Ð¾Ð³Ð¾Ð² Ð² JSON Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ
    
    ÐŸÑ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð° JSON Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð°:
    - Ð›ÐµÐ³ÐºÐ¾ Ð¿Ð°Ñ€ÑÐ¸Ñ‚ÑŒ
    - Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°Ð¼Ð¸ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°
    - Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
    - ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ Ð¿Ð¾Ð»ÑÐ¼
    """
    
    def format(self, record: logging.LogRecord) -> str:
        log_data = {
            "timestamp": datetime.now(timezone.utc).isoformat() + "Z",
            "level": record.levelname,
            "logger": record.name,
            "message": record.getMessage(),
            "module": record.module,
            "function": record.funcName,
            "line": record.lineno
        }
        
        # Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ
        if hasattr(record, 'extra'):
            log_data.update(record.extra)
        
        # Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ exception info ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ
        if record.exc_info:
            log_data["exception"] = self.formatException(record.exc_info)
        
        return json.dumps(log_data, ensure_ascii=False)

def setup_logging(debug: bool = False):
    """ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ"""
    
    log_level = "DEBUG" if debug else "INFO"
    
    logging_config = {
        "version": 1,
        "disable_existing_loggers": False,
        "formatters": {
            "json": {
                "()": JSONFormatter,
            },
            "simple": {
                "format": "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
            }
        },
        "handlers": {
            "console": {
                "class": "logging.StreamHandler",
                "stream": sys.stdout,
                "formatter": "json" if debug else "simple",
                "level": log_level
            },
            "file": {
                "class": "logging.handlers.RotatingFileHandler",
                "filename": "logs/app.log",
                "maxBytes": 10485760,  # 10 MB
                "backupCount": 5,
                "formatter": "json",
                "level": "INFO"
            },
            "error_file": {
                "class": "logging.handlers.RotatingFileHandler",
                "filename": "logs/error.log",
                "maxBytes": 10485760,
                "backupCount": 5,
                "formatter": "json",
                "level": "ERROR"
            }
        },
        "loggers": {
            "app": {
                "handlers": ["console", "file", "error_file"],
                "level": log_level,
                "propagate": False
            },
            "uvicorn": {
                "handlers": ["console"],
                "level": "INFO",
                "propagate": False
            },
            "sqlalchemy.engine": {
                "handlers": ["console"],
                "level": "WARNING" if not debug else "INFO",
                "propagate": False
            }
        },
        "root": {
            "handlers": ["console"],
            "level": "WARNING"
        }
    }
    
    # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ð°Ð¿ÐºÑƒ Ð´Ð»Ñ Ð»Ð¾Ð³Ð¾Ð²
    import os
    os.makedirs("logs", exist_ok=True)
    
    logging.config.dictConfig(logging_config)
    
    # ÐÐ°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÐ¼ uvicorn Ð»Ð¾Ð³Ð¸
    uvicorn_logger = logging.getLogger("uvicorn")
    uvicorn_logger.handlers = []
    
    return logging.getLogger("app")

# Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð² main.py
logger = setup_logging(settings.DEBUG)
```

### **5. ÐŸÑ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ**

#### **ÐŸÑ€Ð¸Ð¼ÐµÑ€ 1: Ð¡ÐµÑ€Ð²Ð¸Ñ Ñ Ð¿Ð¾Ð»Ð½Ð¾Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¾Ð¹ Ð¾ÑˆÐ¸Ð±Ð¾Ðº**
```python
# app/services/book_service_with_errors.py
import logging
from typing import Optional, Dict, Any
from datetime import datetime, timedelta, timezone
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy.exc import SQLAlchemyError

from app.repositories.book_repository import BookRepository
from app.repositories.author_repository import AuthorRepository
from app.core.exceptions import (
    BookNotFoundException, ValidationException,
    ConflictException, ServiceUnavailableException
)
from app.schemas.book import BookCreate, BookUpdate

logger = logging.getLogger(__name__)

class BookServiceWithErrorHandling:
    """Ð¡ÐµÑ€Ð²Ð¸Ñ Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ ÐºÐ½Ð¸Ð³Ð°Ð¼Ð¸ Ñ Ð¿Ð¾Ð»Ð½Ð¾Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¾Ð¹ Ð¾ÑˆÐ¸Ð±Ð¾Ðº"""
    
    def __init__(self, db: AsyncSession):
        self.db = db
        self.book_repo = BookRepository(db)
        self.author_repo = AuthorRepository(db)
    
    async def get_book(self, book_id: int) -> Dict[str, Any]:
        """ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÐºÐ½Ð¸Ð³Ñƒ Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¾Ð¹ Ð²ÑÐµÑ… Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ñ… Ð¾ÑˆÐ¸Ð±Ð¾Ðº"""
        try:
            book = await self.book_repo.get_with_details(book_id)
            
            if not book:
                raise BookNotFoundException(book_id=book_id)
            
            if book.is_deleted:
                raise BookNotFoundException(
                    book_id=book_id,
                    detail="ÐšÐ½Ð¸Ð³Ð° Ð±Ñ‹Ð»Ð° ÑƒÐ´Ð°Ð»ÐµÐ½Ð°"
                )
            
            # ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÑƒ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð¾Ð²
            book.view_count = getattr(book, 'view_count', 0) + 1
            
            try:
                await self.db.commit()
            except SQLAlchemyError as e:
                logger.error(f"Failed to update view count: {e}")
                await self.db.rollback()
                # ÐÐµ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°ÐµÐ¼ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð»Ð¾Ð³Ð¸Ñ€ÑƒÐµÐ¼ Ð¾ÑˆÐ¸Ð±ÐºÑƒ
            
            return {
                "book": book,
                "metadata": {
                    "request_id": getattr(self.db, 'request_id', None),
                    "timestamp": datetime.now(timezone.utc).isoformat()
                }
            }
            
        except BookNotFoundException:
            # ÐŸÑ€Ð¾Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼ Ð´Ð°Ð»ÑŒÑˆÐµ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ð¼ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¾Ð¼
            raise
            
        except SQLAlchemyError as e:
            logger.error(
                f"Database error while fetching book {book_id}: {e}",
                extra={
                    "book_id": book_id,
                    "error_type": e.__class__.__name__
                },
                exc_info=True
            )
            raise ServiceUnavailableException(
                service="database",
                detail="ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ ÐºÐ½Ð¸Ð³Ðµ"
            )
            
        except Exception as e:
            logger.critical(
                f"Unexpected error while fetching book {book_id}: {e}",
                extra={
                    "book_id": book_id,
                    "error_type": e.__class__.__name__
                },
                exc_info=True
            )
            raise
    
    async def create_book(self, book_data: BookCreate, user_id: int) -> Dict[str, Any]:
        """Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÐºÐ½Ð¸Ð³Ñƒ Ñ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸ÐµÐ¹ Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¾Ð¹ Ð¾ÑˆÐ¸Ð±Ð¾Ðº"""
        try:
            # Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð±Ð¸Ð·Ð½ÐµÑ-Ð¿Ñ€Ð°Ð²Ð¸Ð»
            if book_data.publication_year > datetime.now(timezone.utc).year:
                raise ValidationException(
                    detail="Ð“Ð¾Ð´ Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ð¸ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð² Ð±ÑƒÐ´ÑƒÑ‰ÐµÐ¼",
                    errors={"publication_year": "must_not_be_future"}
                )
            
            if book_data.price <= 0:
                raise ValidationException(
                    detail="Ð¦ÐµÐ½Ð° Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹",
                    errors={"price": "must_be_positive"}
                )
            
            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ð½Ð¸Ñ Ð°Ð²Ñ‚Ð¾Ñ€Ð°
            author = await self.author_repo.get(book_data.author_id)
            if not author:
                raise ValidationException(
                    detail="Ð£ÐºÐ°Ð·Ð°Ð½Ð½Ñ‹Ð¹ Ð°Ð²Ñ‚Ð¾Ñ€ Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚",
                    errors={"author_id": "author_not_found"}
                )
            
            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ ISBN
            existing_book = await self.book_repo.get_by_isbn(book_data.isbn)
            if existing_book:
                raise ConflictException(
                    detail="ÐšÐ½Ð¸Ð³Ð° Ñ Ñ‚Ð°ÐºÐ¸Ð¼ ISBN ÑƒÐ¶Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚",
                    resource="book",
                    conflicting_field="isbn",
                    conflicting_value=book_data.isbn
                )
            
            # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÐºÐ½Ð¸Ð³Ð¸ Ð² Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸
            async with self.db.begin():
                book_dict = book_data.model_dump()
                book_dict.update({
                    "available_copies": book_dict["total_copies"],
                    "created_by": user_id
                })
                
                book = await self.book_repo.create(**book_dict)
                
                # Ð›Ð¾Ð³Ð¸Ñ€ÑƒÐµÐ¼ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ
                logger.info(
                    f"Book created: {book.id} - {book.title}",
                    extra={
                        "book_id": book.id,
                        "title": book.title,
                        "author_id": book.author_id,
                        "created_by": user_id
                    }
                )
                
                return {
                    "book": book,
                    "message": "ÐšÐ½Ð¸Ð³Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð°",
                    "location": f"/api/v1/books/{book.id}"
                }
                
        except (ValidationException, ConflictException):
            # ÐŸÑ€Ð¾Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼ Ð¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ðµ Ð±Ð¸Ð·Ð½ÐµÑ-Ð¾ÑˆÐ¸Ð±ÐºÐ¸
            raise
            
        except SQLAlchemyError as e:
            await self.db.rollback()
            logger.error(
                f"Database error while creating book: {e}",
                extra={
                    "book_data": book_data.model_dump(),
                    "user_id": user_id,
                    "error_type": e.__class__.__name__
                },
                exc_info=True
            )
            raise ServiceUnavailableException(
                service="database",
                detail="ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ ÐºÐ½Ð¸Ð³Ñƒ"
            )
            
        except Exception as e:
            await self.db.rollback()
            logger.critical(
                f"Unexpected error while creating book: {e}",
                extra={
                    "book_data": book_data.model_dump(),
                    "user_id": user_id,
                    "error_type": e.__class__.__name__
                },
                exc_info=True
            )
            raise
    
    async def borrow_book(
        self, 
        book_id: int, 
        user_id: int,
        days: int = 14
    ) -> Dict[str, Any]:
        """Ð’Ð·ÑÑ‚ÑŒ ÐºÐ½Ð¸Ð³Ñƒ Ð² Ð°Ñ€ÐµÐ½Ð´Ñƒ Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¾Ð¹ Ð²ÑÐµÑ… ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ² Ð¾ÑˆÐ¸Ð±Ð¾Ðº"""
        try:
            # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ ÐºÐ½Ð¸Ð³Ñƒ Ñ Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÐ¾Ð¹ Ð´Ð»Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ
            book = await self.book_repo.get_with_lock(book_id)
            if not book:
                raise BookNotFoundException(book_id=book_id)
            
            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ
            if book.available_copies <= 0:
                raise BookNotAvailableException(
                    book_id=book_id,
                    available_copies=book.available_copies
                )
            
            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ð½ÐµÑ‚ Ð»Ð¸ Ñƒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ ÑƒÐ¶Ðµ ÑÑ‚Ð¾Ð¹ ÐºÐ½Ð¸Ð³Ð¸
            from app.repositories.booking_repository import BookingRepository
            booking_repo = BookingRepository(self.db)
            
            active_booking = await booking_repo.get_active_booking(user_id, book_id)
            if active_booking:
                raise UserAlreadyHasBookException(user_id, book_id)
            
            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð»Ð¸Ð¼Ð¸Ñ‚Ñ‹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
            user_bookings_count = await booking_repo.count_active_user_bookings(user_id)
            if user_bookings_count >= 5:  # ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ 5 ÐºÐ½Ð¸Ð³ Ð¾Ð´Ð½Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾
                raise ValidationException(
                    detail="ÐŸÑ€ÐµÐ²Ñ‹ÑˆÐµÐ½ Ð»Ð¸Ð¼Ð¸Ñ‚ Ð¾Ð´Ð½Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾ Ð°Ñ€ÐµÐ½Ð´Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ… ÐºÐ½Ð¸Ð³",
                    errors={"user_id": "max_books_limit_exceeded"}
                )
            
            # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð±Ñ€Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð² Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸
            async with self.db.begin():
                # ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ñ… ÐºÐ¾Ð¿Ð¸Ð¹
                book.available_copies -= 1
                
                # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð¾ Ð±Ñ€Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸
                booking = await booking_repo.create(
                    user_id=user_id,
                    book_id=book_id,
                    start_date=datetime.now(timezone.utc),
                    end_date=datetime.now(timezone.utc) + timedelta(days=days),
                    status="active"
                )
                
                logger.info(
                    f"Book borrowed: book_id={book_id}, user_id={user_id}",
                    extra={
                        "book_id": book_id,
                        "user_id": user_id,
                        "booking_id": booking.id,
                        "days": days
                    }
                )
                
                return {
                    "success": True,
                    "booking_id": booking.id,
                    "message": f"ÐšÐ½Ð¸Ð³Ð° '{book.title}' ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð±Ñ€Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð° Ð½Ð° {days} Ð´Ð½ÐµÐ¹",
                    "due_date": booking.end_date.isoformat(),
                    "remaining_copies": book.available_copies
                }
                
        except (
            BookNotFoundException, 
            BookNotAvailableException,
            UserAlreadyHasBookException,
            ValidationException
        ):
            raise
            
        except SQLAlchemyError as e:
            await self.db.rollback()
            logger.error(
                f"Database error while borrowing book: {e}",
                extra={
                    "book_id": book_id,
                    "user_id": user_id,
                    "error_type": e.__class__.__name__
                },
                exc_info=True
            )
            raise ServiceUnavailableException(
                service="database",
                detail="ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð½Ð° Ð°Ñ€ÐµÐ½Ð´Ñƒ"
            )
            
        except Exception as e:
            await self.db.rollback()
            logger.critical(
                f"Unexpected error while borrowing book: {e}",
                extra={
                    "book_id": book_id,
                    "user_id": user_id,
                    "error_type": e.__class__.__name__
                },
                exc_info=True
            )
            raise
```

#### **ÐŸÑ€Ð¸Ð¼ÐµÑ€ 2: Endpoint Ñ Ð¿Ð¾Ð»Ð½Ð¾Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¾Ð¹ Ð¾ÑˆÐ¸Ð±Ð¾Ðº**
```python
# app/api/v1/endpoints/books_advanced.py
import logging
from fastapi import APIRouter, Depends, Query, status
from typing import Optional
from sqlalchemy.ext.asyncio import AsyncSession

from app.api.deps import get_db, get_current_user, require_roles
from app.schemas.book import BookCreate, BookUpdate
from app.services.book_service_with_errors import BookServiceWithErrorHandling
from app.models.user import UserRole

router = APIRouter(prefix="/books", tags=["books"])
logger = logging.getLogger(__name__)

@router.get("/{book_id}")
async def get_book_details(
    book_id: int,
    db: AsyncSession = Depends(get_db),
):
    """ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½ÑƒÑŽ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ ÐºÐ½Ð¸Ð³Ðµ Ñ Ð¿Ð¾Ð»Ð½Ð¾Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¾Ð¹ Ð¾ÑˆÐ¸Ð±Ð¾Ðº"""
    try:
        book_service = BookServiceWithErrorHandling(db)
        result = await book_service.get_book(book_id)
        
        return {
            "success": True,
            "data": result["book"],
            "metadata": result.get("metadata", {})
        }
        
    except Exception as e:
        # Ð›Ð¾Ð³Ð¸Ñ€ÑƒÐµÐ¼ Ð² endpoint Ð´Ð»Ñ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð³Ð¾ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð°
        logger.error(
            f"Error in get_book_details endpoint: {e}",
            extra={
                "book_id": book_id,
                "endpoint": "GET /books/{book_id}"
            }
        )
        # ÐŸÑ€Ð¾Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ð¼ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¾Ð¼
        raise

@router.post("/", status_code=status.HTTP_201_CREATED)
async def create_book_advanced(
    book_data: BookCreate,
    db: AsyncSession = Depends(get_db),
    current_user: dict = Depends(require_roles([UserRole.LIBRARIAN, UserRole.ADMIN])),
):
    """Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÐºÐ½Ð¸Ð³Ñƒ Ñ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ð¾Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¾Ð¹ Ð¾ÑˆÐ¸Ð±Ð¾Ðº"""
    try:
        # Ð›Ð¾Ð³Ð¸Ñ€ÑƒÐµÐ¼ Ð½Ð°Ñ‡Ð°Ð»Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ
        logger.info(
            "Creating book",
            extra={
                "user_id": current_user["id"],
                "book_title": book_data.title,
                "author_id": book_data.author_id
            }
        )
        
        book_service = BookServiceWithErrorHandling(db)
        result = await book_service.create_book(book_data, current_user["id"])
        
        # Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Location Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ð¾Ð³Ð¾ Ñ€ÐµÑÑƒÑ€ÑÐ°
        from fastapi.responses import JSONResponse
        return JSONResponse(
            status_code=status.HTTP_201_CREATED,
            content={
                "success": True,
                "data": result["book"],
                "message": result["message"]
            },
            headers={"Location": result["location"]}
        )
        
    except Exception as e:
        logger.error(
            f"Error in create_book_advanced endpoint: {e}",
            extra={
                "user_id": current_user["id"],
                "book_data": book_data.model_dump(),
                "endpoint": "POST /books/"
            }
        )
        raise

@router.post("/{book_id}/borrow")
async def borrow_book_advanced(
    book_id: int,
    days: int = Query(14, ge=1, le=60, description="ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð´Ð½ÐµÐ¹ Ð°Ñ€ÐµÐ½Ð´Ñ‹"),
    db: AsyncSession = Depends(get_db),
    current_user: dict = Depends(get_current_user),
):
    """Ð’Ð·ÑÑ‚ÑŒ ÐºÐ½Ð¸Ð³Ñƒ Ð² Ð°Ñ€ÐµÐ½Ð´Ñƒ Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¾Ð¹ Ð²ÑÐµÑ… ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ²"""
    try:
        logger.info(
            "Processing book borrow request",
            extra={
                "book_id": book_id,
                "user_id": current_user["id"],
                "days": days
            }
        )
        
        book_service = BookServiceWithErrorHandling(db)
        result = await book_service.borrow_book(book_id, current_user["id"], days)
        
        return {
            "success": True,
            "data": result
        }
        
    except Exception as e:
        logger.error(
            f"Error in borrow_book_advanced endpoint: {e}",
            extra={
                "book_id": book_id,
                "user_id": current_user["id"],
                "days": days,
                "endpoint": "POST /books/{book_id}/borrow"
            }
        )
        raise
```

### **6. Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº**

**Ð—Ð°Ñ‡ÐµÐ¼ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ Ð¾ÑˆÐ¸Ð±Ð¾Ðº:**
- Ð£Ð±ÐµÐ´Ð¸Ñ‚ÑŒÑÑ, Ñ‡Ñ‚Ð¾ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÑŽÑ‚ÑÑ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾
- ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²
- Ð£Ð±ÐµÐ´Ð¸Ñ‚ÑŒÑÑ, Ñ‡Ñ‚Ð¾ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚
- ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ (Ð½Ðµ Ñ€Ð°ÑÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð»Ð¸ÑˆÐ½ÑÑ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ)

**ÐŸÑ€Ð¸Ð½Ñ†Ð¸Ð¿Ñ‹:**
- Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð²ÑÐµ Ñ‚Ð¸Ð¿Ñ‹ Ð¾ÑˆÐ¸Ð±Ð¾Ðº
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐ¹Ñ‚Ðµ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð¼Ð¾ÐºÐ¸ Ð´Ð»Ñ Ð¸Ð¼Ð¸Ñ‚Ð°Ñ†Ð¸Ð¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº
- Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÐºÐ°Ðº Ð² dev, Ñ‚Ð°Ðº Ð¸ Ð² production Ñ€ÐµÐ¶Ð¸Ð¼Ðµ

```python
# tests/test_error_handling.py
import pytest
from fastapi.testclient import TestClient
from unittest.mock import Mock, patch
import json

from app.main import app
from app.core.exceptions import BookNotFoundException

client = TestClient(app)

def test_not_found_error():
    """Ð¢ÐµÑÑ‚ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ 404 Ð¾ÑˆÐ¸Ð±ÐºÐ¸"""
    response = client.get("/api/v1/nonexistent-endpoint")
    assert response.status_code == 404
    data = response.json()
    assert "error" in data
    assert data["error"]["code"] == "ENDPOINT_NOT_FOUND"

def test_validation_error():
    """Ð¢ÐµÑÑ‚ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸"""
    # ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ ISBN Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚
    invalid_book_data = {
        "title": "Test Book",
        "isbn": "invalid-isbn",  # ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚
        "author_id": 1,
        "publication_year": 2024,
        "price": 1000.0
    }
    
    response = client.post("/api/v1/books/", json=invalid_book_data)
    assert response.status_code == 422
    data = response.json()
    assert data["error"]["code"] == "VALIDATION_ERROR"
    assert "errors" in data["error"]

def test_custom_exception():
    """Ð¢ÐµÑÑ‚ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ñ… Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹"""
    with patch('app.services.book_service.BookService.get_book') as mock_get_book:
        mock_get_book.side_effect = BookNotFoundException(book_id=999)
        
        response = client.get("/api/v1/books/999")
        assert response.status_code == 404
        data = response.json()
        assert data["error"]["code"] == "NOT_FOUND"

def test_database_error():
    """Ð¢ÐµÑÑ‚ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…"""
    with patch('app.services.book_service.BookService.get_books') as mock_get_books:
        from sqlalchemy.exc import SQLAlchemyError
        mock_get_books.side_effect = SQLAlchemyError("Database connection failed")
        
        response = client.get("/api/v1/books/")
        assert response.status_code == 500
        data = response.json()
        assert data["error"]["code"] == "DATABASE_ERROR"

def test_rate_limit_error():
    """Ð¢ÐµÑÑ‚ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð¿Ñ€ÐµÐ²Ñ‹ÑˆÐµÐ½Ð¸Ñ Ð»Ð¸Ð¼Ð¸Ñ‚Ð° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²"""
    # Ð˜Ð¼Ð¸Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð¿Ñ€ÐµÐ²Ñ‹ÑˆÐµÐ½Ð¸Ðµ Ð»Ð¸Ð¼Ð¸Ñ‚Ð°
    with patch('app.api.deps.rate_limiter') as mock_limiter:
        from app.core.exceptions import RateLimitException
        mock_limiter.side_effect = RateLimitException(retry_after=30)
        
        response = client.get("/api/v1/books/")
        assert response.status_code == 429
        assert "Retry-After" in response.headers
        data = response.json()
        assert data["error"]["code"] == "RATE_LIMIT_EXCEEDED"

def test_error_response_format():
    """Ð¢ÐµÑÑ‚ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð° Ð¾Ñ‚Ð²ÐµÑ‚Ð° Ð¿Ñ€Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐµ"""
    response = client.get("/api/v1/books/999999")
    
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ð¾Ñ‚Ð²ÐµÑ‚Ð°
    data = response.json()
    
    assert "error" in data
    error = data["error"]
    
    assert "code" in error
    assert "message" in error
    assert "path" in error
    
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ ÐºÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð² Ð²ÐµÑ€Ñ…Ð½ÐµÐ¼ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ðµ
    assert error["code"].isupper() or "_" in error["code"]

def test_logging_on_error(mocker):
    """Ð¢ÐµÑÑ‚ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¿Ñ€Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ…"""
    mock_logger = mocker.patch('app.core.exception_handlers.logger')
    
    # Ð’Ñ‹Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ð¾ÑˆÐ¸Ð±ÐºÑƒ
    with patch('app.services.book_service.BookService.get_book') as mock_get_book:
        mock_get_book.side_effect = Exception("Test error")
        
        response = client.get("/api/v1/books/1")
        assert response.status_code == 500
    
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð±Ñ‹Ð»Ð° Ð·Ð°Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð°
    assert mock_logger.error.called or mock_logger.critical.called
```

## **ðŸ† ÐŸÑ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ Ð½Ð° Ð½ÐµÐ´ÐµÐ»Ð¸ 9-10**

### **Ð§Ð°ÑÑ‚ÑŒ 1: Ð ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº**

**Ð¦ÐµÐ»ÑŒ:** Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½ÑƒÑŽ ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ñ ÐµÐ´Ð¸Ð½Ñ‹Ð¼ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¾Ð¼ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð².

1. **Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð¸ÐµÑ€Ð°Ñ€Ñ…Ð¸ÑŽ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹:**
   - `BaseAPIException` - Ð±Ð°Ð·Ð¾Ð²Ð¾Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ð²ÑÐµÑ… API Ð¾ÑˆÐ¸Ð±Ð¾Ðº
   - Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ: `NotFoundException`, `ValidationException`, `UnauthorizedException`, `ForbiddenException`, `ConflictException`
   - Ð‘Ð¸Ð·Ð½ÐµÑ-Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ: `BookNotFoundException`, `InsufficientFundsException`, `BookNotAvailableException`
   - ÐšÐ°Ð¶Ð´Ð¾Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð¸Ð¼ÐµÑ‚ÑŒ `error_code` Ð¸ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ð²Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ

2. **Ð ÐµÐ°Ð»Ð¸Ð·ÑƒÐ¹Ñ‚Ðµ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸:**
   - ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ñ… Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹ (`BaseAPIException`)
   - ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ (`RequestValidationError`, `ValidationError`)
   - ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð‘Ð” (`IntegrityError`, `SQLAlchemyError`)
   - Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð²ÑÐµÑ… Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹ (`Exception`)
   - ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº 404 Ð´Ð»Ñ Ð½ÐµÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ñ… endpoints
   - Ð’ÑÐµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°Ñ‚ÑŒ ÐµÐ´Ð¸Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð°

3. **Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ middleware:**
   - `RequestIDMiddleware` - Ð´Ð»Ñ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ ID Ðº ÐºÐ°Ð¶Ð´Ð¾Ð¼Ñƒ Ð·Ð°Ð¿Ñ€Ð¾ÑÑƒ
   - `TimingMiddleware` - Ð´Ð»Ñ Ð¸Ð·Ð¼ÐµÑ€ÐµÐ½Ð¸Ñ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²
   - `LoggingMiddleware` - Ð´Ð»Ñ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð²ÑÐµÑ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²
   - ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ middleware Ð²Ð°Ð¶ÐµÐ½!

### **Ð§Ð°ÑÑ‚ÑŒ 2: Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ð² Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÑ‡Ð½Ð¾Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ**

1. **ÐœÐ¾Ð´Ð¸Ñ„Ð¸Ñ†Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÑÐµÑ€Ð²Ð¸ÑÑ‹:**
   - Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ `HTTPException` Ð½Ð° ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð¸Ð· `app.core.exceptions`
   - Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ Ð²ÑÐµÑ… Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ñ… Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð² ÐºÐ°Ð¶Ð´Ð¾Ð¼ Ð¼ÐµÑ‚Ð¾Ð´Ðµ:
     - `SQLAlchemyError` â†’ `ServiceUnavailableException`
     - ÐžÑ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ðµ Ñ€ÐµÑÑƒÑ€ÑÐ° â†’ `NotFoundException`
     - ÐÐ°Ñ€ÑƒÑˆÐµÐ½Ð¸Ðµ Ð±Ð¸Ð·Ð½ÐµÑ-Ð¿Ñ€Ð°Ð²Ð¸Ð» â†’ `ValidationException` Ð¸Ð»Ð¸ `ConflictException`
   - Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð½Ñ‹Ðµ Ð»Ð¾Ð³Ð¸ Ñ `request_id`, `user_id`, Ð¸ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸ Ð¿Ð¾Ð»ÑÐ¼Ð¸
   - Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð´Ð»Ñ Ð°Ñ‚Ð¾Ð¼Ð°Ñ€Ð½Ð¾ÑÑ‚Ð¸ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹

2. **ÐœÐ¾Ð´Ð¸Ñ„Ð¸Ñ†Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ endpoints:**
   - ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð¹Ñ‚Ðµ ÑÐ¿ÐµÑ†Ð¸Ñ„Ð¸Ñ‡Ð½Ñ‹Ðµ Ð´Ð»Ñ endpoint Ð¾ÑˆÐ¸Ð±ÐºÐ¸
   - Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ HTTP ÑÑ‚Ð°Ñ‚ÑƒÑ-ÐºÐ¾Ð´Ñ‹
   - Ð’ÐµÑ€Ð½Ð¸Ñ‚Ðµ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ…
   - Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `response_model` Ð´Ð»Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ ÑƒÑÐ¿ÐµÑˆÐ½Ñ‹Ñ… Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²
   - Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð² docstrings

3. **ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº:**
   - ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ (Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ)
   - ÐžÑ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ñ€ÐµÑÑƒÑ€ÑÑ‹ (404)
   - ÐÐ°Ñ€ÑƒÑˆÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð°Ð² Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° (401, 403)
   - ÐžÑˆÐ¸Ð±ÐºÐ¸ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… (500, 503)
   - ÐšÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… (409)
   - ÐŸÑ€ÐµÐ²Ñ‹ÑˆÐµÐ½Ð¸Ðµ Ð»Ð¸Ð¼Ð¸Ñ‚Ð¾Ð² (429)

### **Ð§Ð°ÑÑ‚ÑŒ 3: ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ð¸ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ**

1. **ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ:**
   - JSON Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð´Ð»Ñ production (Ð»ÐµÐ³ÐºÐ¾ Ð¿Ð°Ñ€ÑÐ¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°Ð¼Ð¸ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°)
   - ÐŸÑ€Ð¾ÑÑ‚Ð¾Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ (Ñ‡Ð¸Ñ‚Ð°ÐµÐ¼Ð¾)
   - Ð Ð°Ð·Ð´ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð»Ð¾Ð³Ð¸ Ð´Ð»Ñ Ð¾ÑˆÐ¸Ð±Ð¾Ðº (`error.log`) Ð¸ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ (`app.log`)
   - Ð Ð¾Ñ‚Ð°Ñ†Ð¸Ñ Ð»Ð¾Ð³Ð¾Ð² (Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ðµ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð° Ñ„Ð°Ð¹Ð»Ð¾Ð²)
   - ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð´Ð»Ñ Ñ€Ð°Ð·Ð½Ñ‹Ñ… ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð²

2. **Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸:**
   - ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð¿Ð¾ Ñ‚Ð¸Ð¿Ð°Ð¼ (Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Prometheus)
   - Ð’Ñ€ÐµÐ¼Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² (Ñ‡ÐµÑ€ÐµÐ· `TimingMiddleware`)
   - Ð¡Ñ‚Ð°Ñ‚ÑƒÑ-ÐºÐ¾Ð´Ñ‹ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²
   - ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð¿Ð¾ endpoint'Ð°Ð¼
   - ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð¼Ð¾Ð¶Ð½Ð¾ ÑÐ¾Ð±Ð¸Ñ€Ð°Ñ‚ÑŒ Ñ‡ÐµÑ€ÐµÐ· middleware Ð¸Ð»Ð¸ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ñ‹Ð¹ endpoint `/metrics`

3. **Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ health checks:**
   - `GET /health` - Ð±Ð°Ð·Ð¾Ð²Ñ‹Ð¹ health check
   - `GET /health/detailed` - Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð²ÑÐµÑ… Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
   - `GET /health/ready` - readiness probe Ð´Ð»Ñ Kubernetes
   - ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº Ð‘Ð”
   - ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð²Ð½ÐµÑˆÐ½Ð¸Ñ… ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð² (Redis, Ð²Ð½ÐµÑˆÐ½Ð¸Ðµ API)
   - ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ²Ð¾Ð±Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð¼ÐµÑÑ‚Ð° Ð½Ð° Ð´Ð¸ÑÐºÐµ
   - ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¿Ð°Ð¼ÑÑ‚Ð¸

### **Ð§Ð°ÑÑ‚ÑŒ 4: Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Ð¾ÑˆÐ¸Ð±Ð¾Ðº**

1. **Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð²ÑÐµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ API:**
   - Ð’ ÐºÐ¾Ð´Ðµ Ñ‡ÐµÑ€ÐµÐ· docstrings
   - Ð’ OpenAPI ÑÑ…ÐµÐ¼Ðµ
   - Ð’ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾Ð¼ Ñ„Ð°Ð¹Ð»Ðµ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸

2. **Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ ÑÐ¿Ñ€Ð°Ð²Ð¾Ñ‡Ð½Ð¸Ðº ÐºÐ¾Ð´Ð¾Ð² Ð¾ÑˆÐ¸Ð±Ð¾Ðº:**
   - Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ñ ÐºÐ¾Ð´Ð¾Ð² Ð¸ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ð¹
   - ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¾ÑˆÐ¸Ð±Ð¾Ðº
   - Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸ÑŽ

## **ðŸ“Š ÐšÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ð¸ Ð¾Ñ†ÐµÐ½ÐºÐ¸**

### **Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ðµ ÐºÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ð¸ (40 Ð±Ð°Ð»Ð»Ð¾Ð²):**
1. **Ð˜ÐµÑ€Ð°Ñ€Ñ…Ð¸Ñ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹** (10 Ð±Ð°Ð»Ð»Ð¾Ð²):
   - Ð›Ð¾Ð³Ð¸Ñ‡Ð½Ð°Ñ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð½Ð°ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ð½Ð¸Ñ
   - ÐŸÐ¾ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ Ð²ÑÐµÑ… Ñ‚Ð¸Ð¿Ð¾Ð² Ð¾ÑˆÐ¸Ð±Ð¾Ðº
   - Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ

2. **Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸** (10 Ð±Ð°Ð»Ð»Ð¾Ð²):
   - ÐšÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð²ÑÐµÑ… Ñ‚Ð¸Ð¿Ð¾Ð² Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹
   - Ð•Ð´Ð¸Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²
   - Ð¡Ð¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ HTTP ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð°Ð¼

3. **Middleware** (10 Ð±Ð°Ð»Ð»Ð¾Ð²):
   - Request ID
   - Ð›Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
   - Ð¢Ð°Ð¹Ð¼Ð¸Ð½Ð³Ð¸

4. **Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ** (10 Ð±Ð°Ð»Ð»Ð¾Ð²):
   - Ð’ÑÐµ endpoints Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÑŽÑ‚ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑ-ÐºÐ¾Ð´Ñ‹
   - Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ…
   - Ð›Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±Ð¾Ðº

### **ÐŸÑ€Ð¾Ð´Ð²Ð¸Ð½ÑƒÑ‚Ñ‹Ðµ ÐºÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ð¸ (30 Ð±Ð°Ð»Ð»Ð¾Ð²):**
1. **Ð‘Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº** (10 Ð±Ð°Ð»Ð»Ð¾Ð²):
   - Ð¡Ð¿ÐµÑ†Ð¸Ñ„Ð¸Ñ‡Ð½Ñ‹Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð´Ð»Ñ Ð´Ð¾Ð¼ÐµÐ½Ð°
   - Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð±Ð¸Ð·Ð½ÐµÑ-Ð¿Ñ€Ð°Ð²Ð¸Ð»
   - ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð½Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ

2. **Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ** (10 Ð±Ð°Ð»Ð»Ð¾Ð²):
   - Ð¢ÐµÑÑ‚Ñ‹ Ð´Ð»Ñ Ð²ÑÐµÑ… Ñ‚Ð¸Ð¿Ð¾Ð² Ð¾ÑˆÐ¸Ð±Ð¾Ðº
   - Ð¢ÐµÑÑ‚Ñ‹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¾Ð² Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²
   - Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ Ñ‚ÐµÑÑ‚Ñ‹

3. **ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³** (10 Ð±Ð°Ð»Ð»Ð¾Ð²):
   - Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð»Ð¾Ð³Ð¸
   - ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº
   - Health checks

### **Ð­ÐºÑÐ¿ÐµÑ€Ñ‚Ð½Ñ‹Ðµ ÐºÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ð¸ (20 Ð±Ð°Ð»Ð»Ð¾Ð²):**
1. **ÐŸÑ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ** (10 Ð±Ð°Ð»Ð»Ð¾Ð²):
   - ÐÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº
   - ÐšÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ‡Ð°ÑÑ‚Ñ‹Ñ… Ð¾ÑˆÐ¸Ð±Ð¾Ðº
   - ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ

2. **Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ** (10 Ð±Ð°Ð»Ð»Ð¾Ð²):
   - ÐÐµ Ñ€Ð°ÑÐºÑ€Ñ‹Ñ‚Ð¸Ðµ Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÐµÐ¹ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸
   - Ð—Ð°Ñ‰Ð¸Ñ‚Ð° Ð¾Ñ‚ Ð°Ñ‚Ð°Ðº Ñ‡ÐµÑ€ÐµÐ· Ð¾ÑˆÐ¸Ð±ÐºÐ¸
   - Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð²Ñ…Ð¾Ð´Ð½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…

## **ðŸ“ˆ Ð›ÑƒÑ‡ÑˆÐ¸Ðµ Ð¿Ñ€Ð°ÐºÑ‚Ð¸ÐºÐ¸**

1. **Ð’ÑÐµÐ³Ð´Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ** Ð²Ð¼ÐµÑÑ‚Ð¾ Ð¾Ð±Ñ‰Ð¸Ñ…
2. **Ð›Ð¾Ð³Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ñ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð¾Ð¼** Ð´Ð»Ñ Ð»ÐµÐ³ÐºÐ¾Ð¹ Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ¸
3. **ÐÐµ Ñ€Ð°ÑÐºÑ€Ñ‹Ð²Ð°Ð¹Ñ‚Ðµ Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÑŽÑŽ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ** Ð² production
4. **Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°Ð¹Ñ‚Ðµ Ð¾Ð´Ð¸Ð½Ð°ÐºÐ¾Ð²Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚** Ð´Ð»Ñ Ð²ÑÐµÑ… Ð¾ÑˆÐ¸Ð±Ð¾Ðº
5. **Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ HTTP ÑÑ‚Ð°Ñ‚ÑƒÑ-ÐºÐ¾Ð´Ñ‹**
6. **Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸** Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ endpoint
7. **Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº** Ñ‚Ð°Ðº Ð¶Ðµ Ñ‚Ñ‰Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾, ÐºÐ°Ðº ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ ÑƒÑÐ¿ÐµÑ…Ð°

## **ðŸŽ¯ Ð˜Ñ‚Ð¾Ð³ Ð½ÐµÐ´ÐµÐ»ÑŒ 9-10**

Ðš ÐºÐ¾Ð½Ñ†Ñƒ ÑÑ‚Ð¸Ñ… Ð½ÐµÐ´ÐµÐ»ÑŒ Ð²Ñ‹ ÑÐ¾Ð·Ð´Ð°Ð´Ð¸Ñ‚Ðµ **Ð¿Ñ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½ÑƒÑŽ ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº**, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ:

1. **ÐŸÑ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÐ¼** Ð¿Ð¾Ð½ÑÑ‚Ð½Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ…
   - ÐŸÐ¾Ð½ÑÑ‚Ð½Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð²Ð¼ÐµÑÑ‚Ð¾ Ñ‚ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹
   - ÐŸÑ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð¿Ð¾ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸ÑŽ
   - Ð¡Ð¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ HTTP ÑÑ‚Ð°Ñ‚ÑƒÑ-ÐºÐ¾Ð´Ñ‹

2. **ÐŸÐ¾Ð¼Ð¾Ð³Ð°ÐµÑ‚ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ°Ð¼** Ð±Ñ‹ÑÑ‚Ñ€Ð¾ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑŒ Ð¸ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹
   - Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ðµ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð¾Ð¼
   - Request ID Ð´Ð»Ñ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²
   - Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð² DEBUG Ñ€ÐµÐ¶Ð¸Ð¼Ðµ

3. **Ð¡Ð¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð°Ð¼** REST API Ð¸ HTTP
   - ÐŸÑ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑ-ÐºÐ¾Ð´Ñ‹
   - Ð•Ð´Ð¸Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²
   - Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ðµ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¸

4. **Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð¸Ñ€ÑƒÐµÑ‚ÑÑ** Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°Ð¼Ð¸ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°
   - JSON Ð»Ð¾Ð³Ð¸ Ð´Ð»Ñ Ð¿Ð°Ñ€ÑÐ¸Ð½Ð³Ð°
   - Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
   - ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº

5. **Ð£Ð»ÑƒÑ‡ÑˆÐ°ÐµÑ‚ Ð¾Ñ‚ÐºÐ°Ð·Ð¾ÑƒÑÑ‚Ð¾Ð¹Ñ‡Ð¸Ð²Ð¾ÑÑ‚ÑŒ** Ð²Ð°ÑˆÐµÐ³Ð¾ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
   - Graceful degradation
   - ÐŸÑ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð²ÑÐµÑ… Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹
   - Ð—Ð°Ñ‰Ð¸Ñ‚Ð° Ð¾Ñ‚ ÑƒÑ‚ÐµÑ‡ÐºÐ¸ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸

**ÐšÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð½Ð°Ð²Ñ‹ÐºÐ¸:**
- ÐŸÑ€Ð¾ÐµÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¸ÐµÑ€Ð°Ñ€Ñ…Ð¸Ð¸ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹
- Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¾Ð² Ð¾ÑˆÐ¸Ð±Ð¾Ðº
- ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
- Ð Ð°Ð±Ð¾Ñ‚Ð° Ñ HTTP ÑÑ‚Ð°Ñ‚ÑƒÑ-ÐºÐ¾Ð´Ð°Ð¼Ð¸
- Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ñ… ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ…
- Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ² Ð¾ÑˆÐ¸Ð±Ð¾Ðº
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ middleware Ð´Ð»Ñ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¸ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°

**Ð’Ð°Ð¶Ð½Ð¾ÑÑ‚ÑŒ:**
ÐŸÑ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº â€” ÑÑ‚Ð¾ Ñ‚Ð¾, Ñ‡Ñ‚Ð¾ Ð¾Ñ‚Ð»Ð¸Ñ‡Ð°ÐµÑ‚ Ð»ÑŽÐ±Ð¸Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ð¾Ñ‚ Ð¿Ñ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾. ÐžÐ½Ð° Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚, Ñ‡Ñ‚Ð¾ Ð²Ñ‹ Ð´ÑƒÐ¼Ð°ÐµÑ‚Ðµ Ð½Ðµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¾ "ÑÑ‡Ð°ÑÑ‚Ð»Ð¸Ð²Ð¾Ð¼ Ð¿ÑƒÑ‚Ð¸", Ð½Ð¾ Ð¸ Ð¾ Ð²ÑÐµÑ… Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ñ… ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑÑ…, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¼Ð¾Ð³ÑƒÑ‚ Ð¿Ñ€Ð¾Ð¸Ð·Ð¾Ð¹Ñ‚Ð¸ Ð² production. 

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:**
- ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÑŽÑ‚ Ð¿Ð¾Ð½ÑÑ‚Ð½Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ…
- Ð Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ Ð±Ñ‹ÑÑ‚Ñ€Ð¾ Ð½Ð°Ñ…Ð¾Ð´ÑÑ‚ Ð¸ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÑÑŽÑ‚ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹
- Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
- ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑÑ Ð±Ð¾Ð»ÐµÐµ Ð½Ð°Ð´ÐµÐ¶Ð½Ñ‹Ð¼ Ð¸ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ñ‹Ð¼